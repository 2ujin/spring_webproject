<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="board">
  <!-- 1. 목록 조회 및 검색 -->
  	<select id="listAll" resultType="com.example.project.model.dto.BoardVO">
  	 select
  	 bno, title, content, b.regdate, viewcnt, user_name as writer
  	 from 
  	 tbl_board b, tbl_member m
  	 <include refid="search"></include>
  	 order by 
  	 bno asc, regdate desc
  	</select>
  
  <select id="countArticle" resultType="int">
  select count(*) from tbl_board b, tbl_member m
  	<include refid="search"></include>
  </select>
  
  <!-- 상세보기 -->
  <select id="view" resultType="com.example.project.model.dto.BoardVO">
  select bno, title, writer, content, b.regdate, viewcnt, user_name as userName from tbl_board b, tbl_member m 
  where b.writer = m.user_id and bno=#{bno}
  </select>
  
  <update id="update">
  	update tbl_board
  	set
  	title=#{title},
  	content=#{content},
  	writer=#{writer}
  	where bno=#{bno}
  </update>
  
  <delete id="delete">
  delete from tbl_board
  where bno=#{bno}
  </delete>
  
  <update id="increaseViewcnt">
  update tbl_board
  set
  viewcnt = viewcnt+1
  where bno=#{bno}
  </update>
  
  <insert id="insert">
    insert into tbl_board(title, content, writer)
    values(#{title}, #{content}, #{writer})
   </insert>
   
   <sql id="search">
	<choose>
		<when test="searchoption.equals('all')">
		
			WHERE b.writer = m.user_id
			and 
			
			(user_name like concat('%', #{keyword}, '%')
			OR content like concat('%', #{keyword}, '%')
			OR title like concat('%', #{keyword}, '%'))
		</when>
		<otherwise>
			WHERE ${searchoption} like concat('%', #{keyword}, '%')
		</otherwise>
	</choose>    
   </sql>

  </mapper>